



<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Guia para consultas rápidas em assuntos relacionados às áreas de programação, desenvolvimento e outras áreas de TI.">
      
      
        <link rel="canonical" href="https://kustavo.github.io/guia-rapido/dotnet/linguagem/programacao-assincrona/">
      
      
        <meta name="author" content="Gustavo Araujo">
      
      <link rel="shortcut icon" href="../../../favicon.svg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>Programação assíncrona - Guia Rápido</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#4051b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"Ubuntu",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    
  
      
    
  <script>document.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(e){if(e.target instanceof HTMLElement){var t=e.target.closest("a[href^=http]");t&&ga("send","event","outbound","click",t.href)}})})</script>

    
  
  
    
  
  

    <meta property="og:type" content="website">
    <meta property="og:title" content="Guia Rápido - Programação assíncrona">
    <meta property="og:description" content="Guia para consultas rápidas em assuntos relacionados às áreas de programação, desenvolvimento e outras áreas de TI.">
    <meta property="og:url" content="https://kustavo.github.io/guia-rapido/dotnet/linguagem/programacao-assincrona/">
    <meta property="og:image" content="https://kustavo.github.io/guia-rapido/assets/images/banner.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1080">
    <meta property="og:image:height" content="568">
    <link rel="stylesheet" href="../../../assets/stylesheets/home.css">

  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#programacao-assincrona" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://kustavo.github.io/guia-rapido/" title="Guia Rápido" class="md-header-nav__button md-logo" aria-label="Guia Rápido">
      
  <img src="../../../logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Guia Rápido
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Programação assíncrona
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/kustavo/guia-rapido/" title="Ir ao repositório" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://kustavo.github.io/guia-rapido/" title="Guia Rápido" class="md-nav__button md-logo" aria-label="Guia Rápido">
      
  <img src="../../../logo.svg" alt="logo">

    </a>
    Guia Rápido
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/kustavo/guia-rapido/" title="Ir ao repositório" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      .Net
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label=".Net" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        .Net
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../erros-solucoes/" title="Erros e soluções" class="md-nav__link">
      Erros e soluções
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Linux
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linux" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Shell
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Shell" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon"></span>
        Shell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../linux/shell/linux-shell/" title="Linux shell" class="md-nav__link">
      Linux shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../linux/shell/bash/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../linux/shell/dash/" title="Dash" class="md-nav__link">
      Dash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../linux/shell/zsh/" title="Z-shell" class="md-nav__link">
      Z-shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../linux/shell/gnome-terminal/" title="Gnome terminal" class="md-nav__link">
      Gnome terminal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Markdown
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Markdown" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Markdown
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      MkDocs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="MkDocs" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        MkDocs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/mkdocs/" title="MkDocs" class="md-nav__link">
      MkDocs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introducao" class="md-nav__link">
    Introdução
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-retorno" class="md-nav__link">
    Tipos de retorno
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-void" class="md-nav__link">
    Async void
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bloqueio" class="md-nav__link">
    Bloqueio
  </a>
  
    <nav class="md-nav" aria-label="Bloqueio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whenall" class="md-nav__link">
    WhenAll
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whenany" class="md-nav__link">
    WhenAny
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoracao-de-estado" class="md-nav__link">
    Monitoração de estado
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/kustavo/guia-rapido/edit/master/docs/dotnet/linguagem/programacao-assincrona.md" title="Editar esta página" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="programacao-assincrona">Programação assíncrona<a class="headerlink" href="#programacao-assincrona" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#programacao-assincrona">Programação assíncrona</a><ul>
<li><a href="#introducao">Introdução</a></li>
<li><a href="#tipos-de-retorno">Tipos de retorno</a></li>
<li><a href="#async-void">Async void</a></li>
<li><a href="#bloqueio">Bloqueio</a><ul>
<li><a href="#whenall">WhenAll</a></li>
<li><a href="#whenany">WhenAny</a></li>
</ul>
</li>
<li><a href="#monitoracao-de-estado">Monitoração de estado</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="introducao">Introdução<a class="headerlink" href="#introducao" title="Permanent link">&para;</a></h2>
<p>Se você tiver qualquer necessidade vinculada à E/S (como a solicitação de dados de uma rede ou o acesso a um banco de dados), você desejará usar a programação assíncrona. Você também pode ter código vinculado à CPU, como a execução de um cálculo dispendioso, que também é um bom cenário para escrever código assíncrono.</p>
<p>O <code>C#</code> tem um modelo de programação assíncrono em nível de linguagem que permite escrever facilmente o código assíncrono sem precisar manipular retornos de chamada ou estar em conformidade com uma biblioteca que dá suporte à assincronia. Ele segue o que é conhecido como  <em>TAP - Task-based Asynchronous Pattern</em> (Padrão Assíncrono Baseado em Tarefa).</p>
<p>O núcleo da programação assíncrona são os objetos <code>Task</code> e <code>Task&lt;T&gt;</code>, que modelam o trabalho que está sendo feito em segundo plano. Eles têm suporte das palavras-chave <code>async</code> e <code>await</code>. O modelo é bastante simples na maioria dos casos:</p>
<ul>
<li>
<p>O código assíncrono pode ser usado tanto para o código vinculado à E/S quanto vinculado à CPU, mas de maneira diferente para cada cenário.</p>
</li>
<li>
<p>Para o código vinculado à E/S, você espera (<code>await</code>) uma operação que retorna uma tarefa (<code>Task</code> ou <code>Task&lt;T&gt;</code>) dentro de um método assíncrono (<code>async</code>).</p>
</li>
<li>
<p>Para o código vinculado à CPU, você espera (<code>await</code>) uma operação que é iniciada em um <em>thread</em> em segundo plano com o método <code>Task.Run</code>.</p>
</li>
<li>
<p>A palavra-chave <code>async</code> transforma um método em um método assíncrono, o que permite que você use a palavra-chave <code>await</code> em seu corpo.</p>
</li>
<li>
<p>Quando a palavra-chave <code>await</code> é aplicada, ela suspende o método de chamada e transfere o controle de volta ao seu chamador até que a tarefa em espera seja concluída.</p>
</li>
</ul>
<div class='importante' markdown='1'>

Segundo a convenção usada no .NET, você deve adicionar **"Async"** como o sufixo de cada nome de método assíncrono que escrever.

</div>

<div class="highlight"><pre><span></span><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">exemplo_async_await</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">URL</span> <span class="p">=</span> <span class="s">&quot;https://docs.microsoft.com/en-us/dotnet/csharp/csharp&quot;</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TrabalhoSincrono</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">tarefa</span> <span class="p">=</span> <span class="n">TrabalhoAssincrono</span><span class="p">();</span>
            <span class="n">TrabalhoAposEspera</span><span class="p">();</span>

            <span class="c1">// Bloqueia o thread principal, de modo que o método &quot;TrabalhoAssincrono()&quot; possa concluir </span>
            <span class="c1">// a execução antes do encerramento do aplicativo.</span>
            <span class="c1">// Caso contrário os passos 4, 5 e 6 não seriam executados até fim de execução do sistema.</span>
            <span class="n">tarefa</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">TrabalhoSincrono</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;1. Trabalho síncrono&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">TrabalhoAssincrono</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;2. Trabalho assíncrono!&quot;</span><span class="p">);</span>

            <span class="c1">// Eperando o método Async GetStringAsync</span>
            <span class="k">await</span> <span class="nf">GetStringAsync</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">GetStringAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;3. Esperando o resultado de GetStringAsync&quot;</span><span class="p">);</span>

                <span class="c1">// Espera GetStringAsync (Task&lt;string&gt;) completar </span>
                <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">GetStringAsync</span><span class="p">(</span><span class="n">URL</span><span class="p">);</span>

                <span class="c1">// Para as linha abaixo, a execuçãoo será retomada assim que as espera for concluída.</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;4. A tarefa em espera foi completada&quot;</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="s">&quot;5. O tamanho do http Get para {URL}&quot;</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="s">&quot;6. {result.Length} caracteres&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">TrabalhoAposEspera</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Executa o trabalho enquanto aguarda a conclusão da Tarefa assíncrona</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;7. Trabalho enquanto aguardamos a conclusão da tarefa assíncrona&quot;</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">5</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">j</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;=</span> <span class="m">5</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Saida</span>
<span class="c1">// &gt; 1. Trabalho síncrono</span>
<span class="c1">// &gt; 2. Trabalho assíncrono!</span>
<span class="c1">// &gt; 3. Esperando o resultado de GetStringAsync</span>
<span class="c1">// &gt; 7. Trabalho enquanto aguardamos a conclusão da tarefa assíncrona</span>
<span class="c1">// &gt; ******</span>
<span class="c1">// &gt; *****</span>
<span class="c1">// &gt; ****</span>
<span class="c1">// &gt; ***</span>
<span class="c1">// &gt; **</span>
<span class="c1">// &gt; *</span>
<span class="c1">// &gt; 4. A tarefa em espera foi completada</span>
<span class="c1">// &gt; 5. O tamanho do http Get para https://docs.microsoft.com/en-us/dotnet/csharp/csharp</span>
<span class="c1">// &gt; 6. 40165 caracteres</span>
</code></pre></div>

<p>Outro exemplo, mostrando o fluxo de funcionamento:</p>
<div class='imagem' markdown='1' style="width: 100%">

![exemplo-fluxo-assincrono](_programacao-assincrona/exemplo-fluxo-assincrono.png)

</div>

<h2 id="tipos-de-retorno">Tipos de retorno<a class="headerlink" href="#tipos-de-retorno" title="Permanent link">&para;</a></h2>
<p>Métodos assíncronos podem conter os seguintes tipos de retorno:</p>
<ul>
<li>
<p><strong><code>Task&lt;TResult&gt;</code></strong>: para um método assíncrono que retorna um valor.</p>
</li>
<li>
<p><strong><code>Task</code></strong>: para um método assíncrono que executa uma operação, mas não retorna nenhum valor.</p>
</li>
<li>
<p><strong><code>void</code></strong>: para um manipulador de eventos.</p>
</li>
<li>
<p>Desde o <code>C# 7.0</code>, qualquer tipo que tenha um método acessível <code>GetAwaiter</code>. O objeto retornado pelo método <code>GetAwaiter</code> deve implementar a interface <strong><code>System.Runtime.CompilerServices.ICriticalNotifyCompletion</code></strong>.</p>
</li>
</ul>
<p><a href="https://docs.microsoft.com/pt-br/dotnet/csharp/programming-guide/concepts/async/async-return-types">Veja mais</a></p>
<h2 id="async-void">Async void<a class="headerlink" href="#async-void" title="Permanent link">&para;</a></h2>
<p>Async void só deve ser usado para manipuladores de eventos.
O <code>async void</code> é a única maneira de permitir que os manipuladores de eventos assíncronos trabalhem, pois os eventos não têm tipos de retorno (portanto, não podem fazer uso de <code>Task</code> e <code>Task&lt;T&gt;</code>). Qualquer outro uso de <code>async void</code> não segue o modelo TAP e pode ser um desafio utilizá-lo, como:</p>
<ul>
<li>
<p>As exceções lançadas em um método <code>async void</code> não podem ser capturadas fora desse método.</p>
</li>
<li>
<p>Os métodos <code>async void</code> são muito difíceis de testar.</p>
</li>
<li>
<p>Os métodos <code>async void</code> poderão causar efeitos colaterais indesejados se o chamador não estiver esperando que eles sejam assíncronos.</p>
</li>
</ul>
<h2 id="bloqueio">Bloqueio<a class="headerlink" href="#bloqueio" title="Permanent link">&para;</a></h2>
<p>Código que bloqueia a thread atual como um meio de aguardar a conclusão de uma tarefa pode resultar em deadlocks e threads de contexto bloqueados e pode exigir tratamento de erros significativamente mais complexo. A tabela a seguir fornece diretrizes de como lidar com a espera de tarefas de uma forma sem bloqueio:</p>
<table>
<thead>
<tr>
<th>Use isto...</th>
<th>Em vez disto...</th>
<th>Quando desejar fazer isso</th>
</tr>
</thead>
<tbody>
<tr>
<td>await</td>
<td>Task.Wait ou Task.Result</td>
<td>Recuperação do resultado de uma tarefa em segundo plano</td>
</tr>
<tr>
<td>await Task.WhenAny</td>
<td>Task.WaitAny</td>
<td>Aguardar a conclusão de qualquer tarefa</td>
</tr>
<tr>
<td>await Task.WhenAll</td>
<td>Task.WaitAll</td>
<td>Aguardar a conclusão de todas as tarefas</td>
</tr>
<tr>
<td>await Task.Delay</td>
<td>Thread.Sleep</td>
<td>Aguardar por um período de tempo</td>
</tr>
</tbody>
</table>
<p><a href="https://docs.microsoft.com/pt-br/dotnet/csharp/programming-guide/concepts/async/">Veja mais</a></p>
<h3 id="whenall">WhenAll<a class="headerlink" href="#whenall" title="Permanent link">&para;</a></h3>
<p>Retorna um <code>Task</code> que é concluído ao final de todas as tarefas na lista de argumentos:</p>
<div class="highlight"><pre><span></span><code><span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">WhenAll</span><span class="p">(</span><span class="n">eggTask</span><span class="p">,</span> <span class="n">baconTask</span><span class="p">,</span> <span class="n">toastTask</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;eggs are ready&quot;</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;bacon is ready&quot;</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;toast is ready&quot;</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Breakfast is ready!&quot;</span><span class="p">);</span>
</code></pre></div>

<h3 id="whenany">WhenAny<a class="headerlink" href="#whenany" title="Permanent link">&para;</a></h3>
<p>Retorna uma <code>Task&lt;Task&gt;</code> que é concluída quando qualquer um dos argumentos é concluído. Você pode aguardar a tarefa retornada, sabendo que ela já foi concluída.</p>
<p>O código a seguir mostra como você poderia usar <code>WhenAny</code> para aguardar a primeira tarefa concluir e, em seguida, processar seu resultado. Depois de processar o resultado da tarefa concluída, você remove essa tarefa concluída da lista de tarefas passada para <code>WhenAny</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kt">var</span> <span class="n">allTasks</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;{</span><span class="n">eggsTask</span><span class="p">,</span> <span class="n">baconTask</span><span class="p">,</span> <span class="n">toastTask</span><span class="p">};</span>
<span class="k">while</span> <span class="p">(</span><span class="n">allTasks</span><span class="p">.</span><span class="n">Any</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">Task</span> <span class="n">finished</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">WhenAny</span><span class="p">(</span><span class="n">allTasks</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">finished</span> <span class="p">==</span> <span class="n">eggsTask</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;eggs are ready&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">finished</span> <span class="p">==</span> <span class="n">baconTask</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;bacon is ready&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">finished</span> <span class="p">==</span> <span class="n">toastTask</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;toast is ready&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">allTasks</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">finished</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Breakfast is ready!&quot;</span><span class="p">);</span>
</code></pre></div>

<h2 id="monitoracao-de-estado">Monitoração de estado<a class="headerlink" href="#monitoracao-de-estado" title="Permanent link">&para;</a></h2>
<p>Devemos escrever código que aguarda tarefas de uma maneira sem bloqueio. Não depender do estado de objetos globais ou da execução de determinados métodos. Em vez disso, depender apenas dos valores retornados dos métodos. Por quê?</p>
<ul>
<li>
<p>Será mais fácil raciocinar sobre o código.</p>
</li>
<li>
<p>O código será mais fácil de testar.</p>
</li>
<li>
<p>Misturar código assíncrono e síncrono será muito mais simples.</p>
</li>
<li>
<p>As condições de corrida poderão, normalmente, ser completamente evitadas.</p>
</li>
<li>
<p>Dependendo dos valores retornados, a coordenação de código assíncrono se tornará simples.</p>
</li>
<li>
<p>Funciona muito bem com a injeção de dependência.</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
      Guia Rápido - 2020
      </div>

      <!-- Social links -->
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../../../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.tabs'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>